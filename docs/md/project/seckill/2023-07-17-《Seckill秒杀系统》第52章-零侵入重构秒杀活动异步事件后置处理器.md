---
title: 第52章：零侵入重构秒杀活动异步事件后置处理器
pay: https://articles.zsxq.com/id_b9wvclbcbmzr.html
---

# 《Seckill秒杀系统》第52章：零侵入重构秒杀活动异步事件后置处理器

作者：冰河
<br/>星球：[http://m6z.cn/6aeFbs](http://m6z.cn/6aeFbs)
<br/>博客：[https://binghe.gitcode.host](https://binghe.gitcode.host)
<br/>文章汇总：[https://binghe.gitcode.host/md/all/all.html](https://binghe.gitcode.host/md/all/all.html)
<br/>源码获取地址：[https://t.zsxq.com/0dhvFs5oR](https://t.zsxq.com/0dhvFs5oR)

> 沉淀，成长，突破，帮助他人，成就自我。

* 本章难度：★★★☆☆
* 本章重点：重点理解并掌握秒杀活动信息变更后，异步事件后置处理器更新秒杀活动缓存的设计与实现，并掌握在原有设计上零侵入升级并扩展秒杀活动异步事件处理器的思想与实现，并能够灵活运用到自身实际项目中。

**大家好，我是冰河~~**

秒杀系统由单体项目拆分为微服务之后，对于秒杀活动异步事件后置处理器的实现就不能仅仅局限于JVM进程内了，需要对这部分的实现升级为分布式架构，并且要对原有的设计与实现做到零侵入，兼容原有的设计与实现，充分体现出秒杀系统在设计上的高度可扩展性。

## 一、前言

目前，在秒杀系统的实现中，当秒杀活动信息变更后，基于Cola实现了JVM进程内的事件发布与接收，领域层会将事件发到到Cola，而应用层则监听并接收Cola中的事件，并更新分布式缓存中的秒杀活动信息。当秒杀系统由单体应用升级为微服务架构后，这种JVM进程内的事件发布与接收就不能满足当前的需求了。

## 二、本章诉求

重构秒杀活动异步事件后置处理器，将JVM进程内的事件发布与接收方式，升级为支持分布式的事件发布与接收方式，并且要对原有的设计与实现做到零侵入，兼容原有的设计与实现，充分体现出秒杀系统在设计上的高度可扩展性。

## 三、业务设计

本节，从流程设计和类结构两个方面来对零侵入重构秒杀活动异步事件后置处理器的设计进行简单的介绍。

### 3.1 流程设计

在秒杀系统中，零侵入重构秒杀活动异步事件后置处理器，并兼容原有设计与实现的流程如图52-1所示。

<div align="center">
    <img src="https://binghe.gitcode.host/images/project/seckill/scekill-2023-07-17-001.png?raw=true" width="80%">
    <br/>
</div>

可以看到，添加秒杀活动和更新秒杀活动状态后，领域层会将事件封装成对应的事件模型发布出去，至于是发布到Cola，还是发布到RocketMQ，完全由配置决定，后续不需要修改代码即可实现。而应用层会监听并接收Cola或者RocketMQ中的事件，并更新活动列表缓存和活动详情缓存。

同时，不管是将事件发布到Cola还是发布到RocketMQ，统一实现了对应的事件模型，而不必单独为每种事件的发布方式单独设计事件模型，体现了事件模型在设计上的通用型和高度可扩展性。

## 查看完整文章

加入[冰河技术](http://m6z.cn/6aeFbs)知识星球，解锁完整技术文章与完整代码